<dashboard script="log_host_monitoring.js" stylesheet="tableAlert.css">
  <label>Broken Hosts</label>
  <row>
    <panel>
      <title>Broken Hosts</title>
      <table id="brokenHosts">
        <title>Hosts that have not sent data to splunk for too long</title>
        <search id="brokenHostsSearch">
          <query>| tstats count max(_time) as lastTime where index=* by _time, index, sourcetype, host span=1d
| eval host=lower(host) | eval index=lower(index) | eval sourcetype=trim(lower(sourcetype), "\"") | `search_additions`
| stats sum(count) as count max(lastTime) as lastTime by _time index, sourcetype, host
| lookup expectedTime index,host,sourcetype OUTPUT | convert auto(suppressUntil)
| fillnull value=`default_contact` contact | fillnull value=`default_expected_time` lateSecs
| eval lateSecs=mvindex(lateSecs,0) | eval contact=mvindex(contact,0) | eval suppressUntil=mvindex(suppressUntil,0)
| eval lateSecs=if(suppressUntil &gt; now(),0,lateSecs)
| eval howLateSecs=now() - lastTime
| eval suppressDate=strftime(suppressUntil,"%D %H:%M:%S") | eval Last=strftime(lastTime, "%D %H:%M:%S")
| stats sparkline(sum(count)) as sparkline min(lateSecs) as lateSecs min(howLateSecs) as howLateSecs max(lastTime) as lastTime by host sourcetype index
| where lateSecs&gt;0 AND (lastTime &lt; now() - lateSecs) AND (now() - lastTime &lt; `ignore_after`) | sort - howLateSecs
| eval howLate=if(howLateSecs&lt;0,"-".tostring(abs(howLateSecs),"duration"),tostring(howLateSecs,"duration")) | rex field=howLate mode=sed "s/\+/ days /" | rex field=howLate mode=sed "s/^1 days/1 day /" | eval h=host | eval i=index | eval s=sourcetype
| rename howLate AS "Time Since Last Event" i AS "Event Index" s AS "Event Sourcetype" h AS "Event Host"</query>
          <earliest>-30d@d</earliest>
          <latest>+1d@d</latest>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <fields>["Event Index","Event Sourcetype","Event Host","Time Since Last Event","sparkline"]</fields>
        <drilldown>
          <eval token="lastTime_minus_1h">relative_time($row.lastTime$, "-1h")</eval>
          <eval token="lastTime_plus_1h">relative_time($row.lastTime$, "+1h")</eval>
          <link target="_blank"><![CDATA[/app/broken_hosts/investigation?form.indexdropdown=$row.index$&form.sourcetypedropdown=$row.sourcetype$&form.hostdropdown=$row.host$&form.lastTime.earliest=$lastTime_minus_1h$&form.lastTime.latest=$lastTime_plus_1h$]]></link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <title>Future Hosts</title>
      <table id="futureHosts">
        <title>Hosts that have data from the future</title>
        <search id="futureHostsSearch">
          <query>| tstats count max(_time) as lastTime where index=* by _time, index, sourcetype, host span=1d
| eval host=lower(host) | eval index=lower(index) | eval sourcetype=trim(lower(sourcetype), "\"") | `search_additions`
| stats sum(count) as count max(lastTime) as lastTime by _time index, sourcetype, host
| lookup expectedTime index,host,sourcetype OUTPUT | convert auto(suppressUntil)
| fillnull value=`default_contact` contact | fillnull value=`default_expected_time` lateSecs
| eval lateSecs=mvindex(lateSecs,0) | eval contact=mvindex(contact,0) | eval suppressUntil=mvindex(suppressUntil,0)
| eval lateSecs=if(suppressUntil &gt; now(),0,lateSecs)
| eval howLateSecs=now() - lastTime | eval h=host | eval i=index | eval s=sourcetype
| eval suppressDate=strftime(suppressUntil,"%D %H:%M:%S") | eval Last=strftime(lastTime, "%D %H:%M:%S")
| stats sparkline(sum(count)) as sparkline min(lateSecs) as lateSecs min(howLateSecs) as howLateSecs max(lastTime) as lastTime by host sourcetype index h i s
| where lateSecs&gt;0 AND (lastTime &gt; now() + 100) AND (now() - lastTime &lt; `ignore_after`) | sort - howLateSecs
| eval howLate=if(howLateSecs&lt;0,"-".tostring(abs(howLateSecs),"duration"),tostring(howLateSecs,"duration")) | rex field=howLate mode=sed "s/\+/ days /" | rex field=howLate mode=sed "s/^1 days/1 day /"
| rename howLate AS "Time Since Last Event" index AS "Event Index" sourcetype AS "Event Sourcetype" host AS "Event Host"</query>
          <earliest>-30d@d</earliest>
          <latest>+7d@d</latest>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <fields>["Event Index","Event Sourcetype","Event Host","Time Since Last Event","sparkline"]</fields>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Suppressed Items</title>
      <table id="suppressed">
        <search id="suppressedSearch">
          <query>| inputlookup expectedTime 
| eval suppressUntil_epoch=if(suppressUntil!="0", round(strptime(suppressUntil, "%m/%d/%Y %H:%M:%S"),0), 0)
| where lateSecs=0 OR suppressUntil_epoch&gt;now() | eval suppressUntil=if(suppressUntil=0,"",suppressUntil)
| fields index, sourcetype, host, suppressUntil, suppressUntil, comments | rename index AS "Event Index" sourcetype AS "Event Sourcetype" host AS "Event Host" suppressUntil AS "Suppressed Until" comments as Comments</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">50</option>
        <option name="dataOverlayMode">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="wrap">true</option>
        <fields>["Event Index","Event Sourcetype","Event Host","Suppressed Until","Comments"]</fields>
      </table>
    </panel>
  </row>
</dashboard>